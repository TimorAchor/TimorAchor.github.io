<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="狂神聊ElasticSearch版本  ElasticSearch7.6.1  我们要讲解什么  SQL：like %狂神说%，如果是大数据，就十分慢！索引！ ElasticSearch : 搜素！(百度、github、淘宝电商)  聊一个人 货比三家 安装 生态圈 分词器 ik RestFul操作  ES CRUD SpringBoot集成ElasticSearch （从原理分析！） 爬虫爬取数">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2021/04/21/ElasticSearch/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="狂神聊ElasticSearch版本  ElasticSearch7.6.1  我们要讲解什么  SQL：like %狂神说%，如果是大数据，就十分慢！索引！ ElasticSearch : 搜素！(百度、github、淘宝电商)  聊一个人 货比三家 安装 生态圈 分词器 ik RestFul操作  ES CRUD SpringBoot集成ElasticSearch （从原理分析！） 爬虫爬取数">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007141948537.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007142513016.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007143357450.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007202331152.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007203042925.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007213807806.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007215540884.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008184536439.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008184553518.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008184433639.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008202651044.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008202719056.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201008204455890.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009203342433.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009205335063.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009214650908.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009215103078.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009215242115.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009220441967.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009220540134.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009221309551.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009222510194.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201009222618333.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014100559709.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014101527996.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014101915702.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014102422741.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014110322312.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014134142373.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014135522892.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014135742979.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014165506380.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201014170836390.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015100050192.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015100445578.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015101419638.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015103214791.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015104654932.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015112303560.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015112327732.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015113617282.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015114704023.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015115300558.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015115707804.png">
<meta property="og:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201015142602828.png">
<meta property="article:published_time" content="2021-04-21T08:24:35.841Z">
<meta property="article:modified_time" content="2020-10-19T01:35:08.206Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:/Users/Timor/AppData/Roaming/Typora/typora-user-images/image-20201007141948537.png">

<link rel="canonical" href="http://example.com/2021/04/21/ElasticSearch/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title> | Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/21/ElasticSearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-04-21 16:24:35" itemprop="dateCreated datePublished" datetime="2021-04-21T16:24:35+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-19 09:35:08" itemprop="dateModified" datetime="2020-10-19T09:35:08+08:00">2020-10-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="狂神聊ElasticSearch"><a href="#狂神聊ElasticSearch" class="headerlink" title="狂神聊ElasticSearch"></a>狂神聊ElasticSearch</h1><p>版本  ElasticSearch7.6.1</p>
<blockquote>
<p>我们要讲解什么</p>
</blockquote>
<p>SQL：like %狂神说%，如果是大数据，就十分慢！索引！</p>
<p>ElasticSearch : 搜素！(百度、github、淘宝电商)</p>
<ol>
<li>聊一个人</li>
<li>货比三家</li>
<li>安装</li>
<li>生态圈</li>
<li>分词器 ik</li>
<li>RestFul操作  ES</li>
<li>CRUD</li>
<li>SpringBoot集成ElasticSearch （从原理分析！）</li>
<li>爬虫爬取数据！</li>
<li>实战，模拟全文检索！</li>
</ol>
<p>以后你只要，需要用到搜索，就可以使用ES！（大数据情况下使用！ ） </p>
<p><strong>Lucene和ElasticSearch关系</strong></p>
<p>ElasticSearch是基于Lucene 做了一些封装和增强（我们上手是十分简单的！）</p>
<h1 id="ElasticSearch概述"><a href="#ElasticSearch概述" class="headerlink" title="ElasticSearch概述"></a>ElasticSearch概述</h1><p>ElasticSearch，简称es, es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别（大数据时代）的数据。es也使用Java开发并使用Luence作为其核心来实现所有索引和搜索的功能，但是他的目的是通过简单的RESTful API来隐藏Luence的复杂性，从而让全文搜索变得简单。</p>
<h1 id="ElasticSearch安装"><a href="#ElasticSearch安装" class="headerlink" title="ElasticSearch安装"></a>ElasticSearch安装</h1><p>声明：JDK1.8，最低要求</p>
<blockquote>
<p>下载</p>
</blockquote>
<p>官网：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p>
<blockquote>
<p>windows下安装</p>
</blockquote>
<p>1.解压</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007141948537.png" alt="image-20201007141948537"></p>
<p> <img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007142513016.png" alt="image-20201007142513016"></p>
<blockquote>
<p>安装可视化界面es head的插件</p>
</blockquote>
<ol>
<li><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></p>
</li>
<li><p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure>
</li>
<li><p>连接测试发现，存在跨域问题</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重启es服务，再次连接</p>
</li>
<li><p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007143357450.png" alt="image-20201007143357450"></p>
</li>
</ol>
<p>初学者，把es当作一个数据库！（可以建立索引（库），文档（库中的数据！））</p>
<blockquote>
<p>这个head我们就把它当做数据展示工具！后的我们的查询用Kibana</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007202331152.png" alt="image-20201007202331152"></p>
<h1 id="ES核心"><a href="#ES核心" class="headerlink" title="ES核心"></a>ES核心</h1><ol>
<li>索引</li>
<li>字段类型(mapping)</li>
<li>文档(documents)</li>
</ol>
<blockquote>
<p>概述</p>
</blockquote>
<p>在前面的学习中，我们已经掌握了es是什么，同时也把es的服务安装启动，那么es是如何去存储数据，数据结构是什么，又是如何实现搜素的呢？我们先来聊聊ElasticSearch的相关概念吧！</p>
<p>==<code>集群 节点 索引 类型 文档 分片 映射 是什么</code>==</p>
<blockquote>
<p>elasticsearch是面向文档，关系型数据库和elasticsearch的客观对比</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007203042925.png" alt="image-20201007203042925"></p>
<p>elasticsearch(集群)中可以包含多个多个索引（数据库），每个索引中可以包含多个类型（表），每个类型下又包含多个文档（行），每个文档中又包含多个字段（列）。</p>
<p><strong>物理设计：</strong></p>
<p>elasticsearch 在后台把每个索引划分成多个分片，每分分片可以在集群中的不同服务器间迁移</p>
<p><strong>逻辑设计：</strong></p>
<p>一个索引类型中，包含多个文档，比如说文档1，文档2。当我们索引一篇文章时，可以通过这样的一个顺序找到它：索引    》 类型 》文档ID，通过这个组合我们就能索引到某个具体的文档。注意：ID不必是整数，实际上它是个字符串。</p>
<blockquote>
<p>文档</p>
</blockquote>
<p><code>就是我们的一条条数据</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">user</span></span><br><span class="line"><span class="number">1</span>	<span class="string">zhangsna</span>	<span class="number">18</span></span><br><span class="line"><span class="number">2</span>	<span class="string">kuangshen</span>	<span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>之前说elasticsearch是面向文档的，那么就意味着索引和搜索数据的最小单位是文档。elasticsearch中，文档有几个重要属性：</p>
<ul>
<li>自我包含，一篇文档同时包含字段和对应的值，也就是同时包含key：value</li>
<li>可以是层次型的，一个文档中包含子文档，复杂的逻辑实体就是这么来的</li>
<li>灵活的结构，文档不依赖预先定义的模式，我们知道关系型数据库中，要提前定义字段才能使用，在elasticsearch中，对于字段是非常灵活的，有时候，我们可以忽略该字段，或者动态的添加一个新的字段。</li>
</ul>
<p>尽管我们可以随意的新增或者忽略某个字段，但是，每个字段的类型非常重要，比如一个年龄字段类型，可以是字符串也可以是整型。因为elasticsearch会保存字段和类型之间的映射及其他的设置。这种映射具体到每个映射的每种类型，这也是为什么在elasticsearch中，类型有时候也称为映射类型。</p>
<blockquote>
<p>类型</p>
</blockquote>
<p>类型是文档的逻辑容器，就像关系型数据库一样，表格是行的容器。类型中对于字段的定义称为映射，比如name映射为字符串类型。我们说文档是无模式的，它们不需要拥有映射中所定义的所有字段，比如新增一个字段，那么elasticsearch是怎么做的呢？elasticsearch会自动的将新字段加入映射，但是这个字段的不确定它是什么类型，elasticsearch就开始猜，如果这个值是18，那么elasticsearch也可能猜不对，所以最安全的方式就是提前定义好所需要的映射，这点跟关系型数据库殊途同归了，先定义好字段，然后再使用。</p>
<blockquote>
<p>索引</p>
</blockquote>
<p><code>就是数据库</code></p>
<p>索引是映射类型的容器，elasticsearch中的索引是一个非常大的文档集合。索引存储了映射类型的字段和其他设置。然后它们被存储到了各个分片上了。我们来研究下分片是如何工作的。</p>
<p><strong>物理设计：节点和分片是如何工作的</strong></p>
<p>一个集群至少有一个节点，而一个节点就是一个elasticsearch进程，节点可以有多个索引默认的，如果你创建索引，那么索引就会有5个分片（primary shard,又称主分片）构成的，每一个分片会有一个副本（replica sahrd，又称复制分片）</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007213807806.png" alt="image-20201007213807806"></p>
<blockquote>
<p>倒排索引</p>
</blockquote>
<p>elasticsearch使用的是一种称为倒排索引的结构，采用Lunence倒排索引作为底层。这种结构适用于快速的全文搜索，一个索引由文档中所有不重复的列表构成，对于每一个词，都有一个包含它的文档列表。</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201007215540884.png" alt="image-20201007215540884"></p>
<h1 id="IK分词器"><a href="#IK分词器" class="headerlink" title="IK分词器"></a>IK分词器</h1><blockquote>
<p>什么是IK分词器</p>
</blockquote>
<p>分词：即把一段中文或者别的词划分成一个个的关键字，我们再搜索时候会把自己的信息进行分词，会把数据库中或者索引库中的数据进行分词，然后进行一个匹配操作，默认的中文分词是将每个字看成一个词，这显然是不符合要求的，所以我们需要安装中文分词器ik来解决这个问题。</p>
<p>IK分词器提供了两个分词算法：ik_smart 和 ik_max_word, 其中 ik_smart 为最少切分， ik_max_word 为最细粒度划分！一会我们测试！</p>
<blockquote>
<p>安装</p>
</blockquote>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
</li>
<li><p>下载完毕之后，放入到我们的elasticsearch 的插件文件夹下</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008184536439.png" alt="image-20201008184536439"></p>
</li>
<li><p>重启观察es，可以看到ik分词器被加载了</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008184553518.png" alt="image-20201008184553518"></p>
</li>
<li><p>elasticsearch-plugin list通过这个命令可以查看加载进来的插件</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008184433639.png" alt="image-20201008184433639"></p>
</li>
<li><p>使用kibana测试</p>
<blockquote>
<p>查看不同的分词器效果</p>
</blockquote>
</li>
</ol>
<p>​       ik_smart 为最少切分， ik_max_word 为最细粒度划分</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008202651044.png" alt="image-20201008202651044"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008202719056.png" alt="image-20201008202719056"></p>
<blockquote>
<p>ik分词器增加自己的配置</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201008204455890.png" alt="image-20201008204455890"></p>
<p>重启es</p>
<h1 id="Rest风格说明"><a href="#Rest风格说明" class="headerlink" title="Rest风格说明"></a>Rest风格说明</h1><p>一种软件架构风格，而不是标准，只是提供了一组设计原则和约束条件。它主要用于客户端和服务器交互类的软件。基于这个风格的设计的软件可以更简洁，更有层次，更易于实现缓存等机制。</p>
<p>基本Rest命令说明：</p>
<table>
<thead>
<tr>
<th>method</th>
<th align="left">url地址</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td align="left">localhost:9200/索引名称/类型名称/文档id</td>
<td>创建文档（指定文档id）</td>
</tr>
<tr>
<td>POST</td>
<td align="left">localhost:9200/索引名称/类型名称</td>
<td>创建文档（随机文档id）</td>
</tr>
<tr>
<td>POST</td>
<td align="left">localhost:9200/索引名称/类型名称/文档id/_update</td>
<td>修改文档</td>
</tr>
<tr>
<td>DELETE</td>
<td align="left">localhost:9200/索引名称/类型名称/文档id/</td>
<td>删除文档</td>
</tr>
<tr>
<td>GET</td>
<td align="left">localhost:9200/索引名称/类型名称/文档id/</td>
<td>查询文档通过文档id</td>
</tr>
<tr>
<td>POST</td>
<td align="left">localhost:9200/索引名称/类型名称/_search</td>
<td>查询所有数据</td>
</tr>
</tbody></table>
<h1 id="关于索引的基本操作"><a href="#关于索引的基本操作" class="headerlink" title="关于索引的基本操作"></a>关于索引的基本操作</h1><p>1.创建一个索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;索引名&#x2F;~类型名~&#x2F;文档id</span><br><span class="line">&#123;请求体&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009203342433.png" alt="image-20201009203342433"></p>
<p>完成了自动增加了索引！数据也成功的添加了，这就是初期可以把它当成数据库学的原因。</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009205335063.png" alt="image-20201009205335063"></p>
<p>3.那么name这个字段用不用指定类型呢。毕竟我们关系型数据库是需要指定类型的</p>
<ul>
<li><p>字符串类型</p>
<p>text、keyword</p>
</li>
<li><p>数值类型</p>
<p>long、integer、short、byte、double、float、half、scaled、float</p>
</li>
<li><p>日期类型</p>
<p>date</p>
</li>
<li><p>布尔值类型</p>
<p>boolean</p>
</li>
<li><p>二进制类型</p>
<p>binary</p>
</li>
<li><p>等等……</p>
</li>
</ul>
<p>4.指定字段的类型</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009214650908.png" alt="image-20201009214650908"></p>
<p> <img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009215103078.png" alt="image-20201009215103078"></p>
<p>5.获得这个规则！可以通过GET请求获取具体的信息</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009215242115.png" alt="image-20201009215242115"></p>
<p>5.查看默认的信息</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009220441967.png" alt="image-20201009220441967"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009220540134.png" alt="image-20201009220540134"></p>
<p>如果自己的文档字段没有指定，那么es就会给我们默认配置字段类型！</p>
<p>扩展：通过命令 elasticsearch索引情况！通过get  _cat/ 可以获得es的当前的很多信息</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009221309551.png" alt="image-20201009221309551"></p>
<blockquote>
<p>修改 提交还是使用PUT即可！ 然后覆盖！最新办法！两种方法！</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009222510194.png" alt="image-20201009222510194"></p>
<blockquote>
<p>删除索引</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201009222618333.png" alt="image-20201009222618333"></p>
<p>通过DELETE命令实现删除、根据你请求的来判断是删除索引还是删除文档记录！</p>
<p>推荐使用RESTFUL风格使用ES</p>
<h1 id="关于文档的基本操作"><a href="#关于文档的基本操作" class="headerlink" title="关于文档的基本操作"></a>关于文档的基本操作</h1><blockquote>
<p>基本操作</p>
</blockquote>
<p>1.添加数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT &#x2F;kuangshen&#x2F;user&#x2F;1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;狂神说&quot;,</span><br><span class="line">  &quot;age&quot;:23,</span><br><span class="line">  &quot;desc&quot;:&quot;一顿操作猛如虎&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;宅&quot;,&quot;暖男&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014100559709.png" alt="image-20201014100559709"></p>
<p>2.获取数据 GET</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014101527996.png" alt="image-20201014101527996"></p>
<p>3.更新数据 PUT</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014101915702.png" alt="image-20201014101915702"></p>
<p>4.POST   _update ,    推荐使用这种更新方式</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014102422741.png" alt="image-20201014102422741"></p>
<p>简单的搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET kuangshen&#x2F;user&#x2F;1</span><br></pre></td></tr></table></figure>

<p>简单的条件查询，可以根据默认的映射规则，产生基本的查询！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET kuangshen&#x2F;user&#x2F;_search?q&#x3D;name:狂神说</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014110322312.png" alt="image-20201014110322312"></p>
<blockquote>
<p>复杂操作搜索  select (排序，分页，高亮，模糊查询，精准查询！)</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014134142373.png" alt="image-20201014134142373"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014135522892.png" alt="image-20201014135522892"></p>
<p>用_source 来选择展示的字段，实现结果的过滤</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014135742979.png" alt="image-20201014135742979"></p>
<p> 我们之后使用Java操作es，所有的方法和对象就是这里面的key！</p>
<blockquote>
<p>排序   sort</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014165506380.png" alt="image-20201014165506380"></p>
<blockquote>
<p>分页查询  from  size</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201014170836390.png" alt="image-20201014170836390"></p>
<p>/search/{current}/{pagesize}</p>
<blockquote>
<p>布尔值查询</p>
</blockquote>
<p>must（相当于and），所有条件都要符合</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015100050192.png" alt="image-20201015100050192"></p>
<p>should (相当于or)</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015100445578.png" alt="image-20201015100445578"></p>
<p> must_not (相当于not)</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015101419638.png" alt="image-20201015101419638"></p>
<p>过滤器（filter）</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015103214791.png" alt="image-20201015103214791"></p>
<ul>
<li>gt 大于</li>
<li>gte 大于等于</li>
<li>lt 小于</li>
<li>lte 小于等于</li>
</ul>
<blockquote>
<p>匹配多个条件</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015104654932.png" alt="image-20201015104654932"></p>
<blockquote>
<p>精确查询！</p>
</blockquote>
<p>term查询是直接通过倒排索引指定的词条进程精确查找的！</p>
<p><strong>关于分词</strong>：</p>
<ul>
<li><p>term，直接查询精确的</p>
</li>
<li><p>match，会使用分词器解析！（先分析文档，然后通过分析的文档进行查询！）</p>
</li>
</ul>
<p><strong>两个类型 text keyword</strong></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015112303560.png" alt="image-20201015112303560"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015112327732.png" alt="image-20201015112327732"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015113617282.png" alt="image-20201015113617282"></p>
<blockquote>
<p>多个值匹配的精确查询</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015114704023.png" alt="image-20201015114704023"></p>
<blockquote>
<p>高亮查询</p>
</blockquote>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015115300558.png" alt="image-20201015115300558"></p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015115707804.png" alt="image-20201015115707804"></p>
<ul>
<li>匹配</li>
<li>按条件匹配</li>
<li>精确匹配</li>
<li>区间范围匹配</li>
<li>匹配字段过滤</li>
<li>多条件查询</li>
<li>高亮查询</li>
</ul>
<h1 id="集成SpringBoot"><a href="#集成SpringBoot" class="headerlink" title="集成SpringBoot"></a>集成SpringBoot</h1><ol>
<li><p>找到原生的依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.6.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化</p>
<p><img src="C:\Users\Timor\AppData\Roaming\Typora\typora-user-images\image-20201015142602828.png" alt="image-20201015142602828"></p>
</li>
<li><p>分析这个类中的方法即可</p>
</li>
</ol>
<blockquote>
<p>配置Config配置类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchClientConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">restHighLevelClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RestHighLevelClient client = <span class="keyword">new</span> RestHighLevelClient(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> HttpHost(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>),</span><br><span class="line">                        <span class="keyword">new</span> HttpHost(<span class="string">&quot;localhost&quot;</span>, <span class="number">9201</span>, <span class="string">&quot;http&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>具体的API测试</p>
</blockquote>
<ol>
<li>创建索引</li>
<li>判断索引是否存在</li>
<li>删除索引</li>
<li>创建文档</li>
<li>CRUD文档</li>
</ol>
<blockquote>
<p>索引的API操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimorEsApiApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="meta">@Qualifier(&quot;restHighLevelClient&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//测试索引的创建   Request</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//1.创建索引请求</span></span><br><span class="line">      CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">      <span class="comment">//2.客户端执行请求 IndicesClient,请求后获得响应</span></span><br><span class="line">      CreateIndexResponse createIndexResponse = client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(createIndexResponse);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//测试获取索引，判断其是否存在</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testExistIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      GetIndexRequest request = <span class="keyword">new</span> GetIndexRequest(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">      <span class="keyword">boolean</span> exists = client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(exists);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//测试删除索引</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">      AcknowledgedResponse delete = client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(delete);</span><br><span class="line">      System.out.println(delete.isAcknowledged());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>文档 的API操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimorEsApiApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="meta">@Qualifier(&quot;restHighLevelClient&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">//测试添加文档</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//创建对象</span></span><br><span class="line">      User user = <span class="keyword">new</span> User(<span class="string">&quot;狂神说&quot;</span>,<span class="number">3</span>);</span><br><span class="line">      <span class="comment">//创建请求</span></span><br><span class="line">      IndexRequest request = <span class="keyword">new</span> IndexRequest(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">      <span class="comment">//规则 put /kuang_index/_doc/1</span></span><br><span class="line">      request.id(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      request.timeout(TimeValue.timeValueSeconds(<span class="number">1</span>));</span><br><span class="line">      request.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line">      <span class="comment">//将我们的数据放入请求 json</span></span><br><span class="line">      IndexRequest source = request.source(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line">      <span class="comment">//客户端发送请求,获取响应结果</span></span><br><span class="line">      IndexResponse indexResponse = client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(indexResponse.toString());</span><br><span class="line">      System.out.println(indexResponse.status());       <span class="comment">//对应我们命令返回的状态</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取文档，判断是否存在</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testIsExists</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      GetRequest getRequest = <span class="keyword">new</span> GetRequest(<span class="string">&quot;kuang_index&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      <span class="comment">//不获取返回的_source的上下文了</span></span><br><span class="line">      getRequest.fetchSourceContext(<span class="keyword">new</span> FetchSourceContext(<span class="keyword">false</span>));</span><br><span class="line">      getRequest.storedFields(<span class="string">&quot;_none_&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">boolean</span> exists = client.exists(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(exists);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获得文档信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testGetDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      GetRequest getRequest = <span class="keyword">new</span> GetRequest(<span class="string">&quot;kuang_index&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      GetResponse getResponse = client.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(getResponse.getSourceAsString());</span><br><span class="line">      System.out.println(getResponse);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 更新文档的信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">      updateRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line">      User user = <span class="keyword">new</span> User(<span class="string">&quot;狂神说Java&quot;</span>,<span class="number">18</span>);</span><br><span class="line">      updateRequest.doc(JSON.toJSONString(user),XContentType.JSON);</span><br><span class="line">      UpdateResponse updateResponse = client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(updateResponse.status());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除文档记录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testDeleteRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      DeleteRequest deleteRequest = <span class="keyword">new</span> DeleteRequest(<span class="string">&quot;kuang_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">      deleteRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line">      DeleteResponse deleteResponse = client.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(deleteResponse.status());</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//真实的项目一般采用批量插入数据</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">      BulkRequest bulkRequest = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">      bulkRequest.timeout(<span class="string">&quot;10s&quot;</span>);</span><br><span class="line">      ArrayList&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen1&quot;</span>,<span class="number">1</span>));</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen2&quot;</span>,<span class="number">2</span>));</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen3&quot;</span>,<span class="number">3</span>));</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen4&quot;</span>,<span class="number">4</span>));</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen5&quot;</span>,<span class="number">5</span>));</span><br><span class="line">      userList.add(<span class="keyword">new</span> User(<span class="string">&quot;kuangshen6&quot;</span>,<span class="number">6</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">//批处理请求</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; userList.size(); i++) &#123;</span><br><span class="line">         bulkRequest.add(</span><br><span class="line">               <span class="keyword">new</span> IndexRequest(<span class="string">&quot;kuang_index&quot;</span>)</span><br><span class="line">               .id(<span class="string">&quot;&quot;</span>+(i+<span class="number">1</span>))</span><br><span class="line">               .source(JSON.toJSONString(userList.get(i)),XContentType.JSON));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      BulkResponse bulkResponse = client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(bulkResponse.hasFailures());          <span class="comment">//是否失败</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//查询</span></span><br><span class="line">   <span class="comment">//SearchRequest 搜索请求</span></span><br><span class="line">   <span class="comment">//SearchSourceBuilder 条件构造</span></span><br><span class="line">   <span class="comment">//HighLightBuilder 构建高亮</span></span><br><span class="line">   <span class="comment">//TermQueryBuilder 精确查询</span></span><br><span class="line">   <span class="comment">//MatchAllQueryBuilder  等等  对应所有命令</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">testSearch</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;kuang_index&quot;</span>);</span><br><span class="line">      <span class="comment">//构建搜索的条件</span></span><br><span class="line">      SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">      <span class="comment">//查询条件，我们可以使用QueryBuilders工具类实现快速匹配</span></span><br><span class="line">      TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;kuangshen1&quot;</span>);</span><br><span class="line">      searchSourceBuilder.query(termQueryBuilder);</span><br><span class="line">      searchSourceBuilder.timeout(<span class="keyword">new</span> TimeValue(<span class="number">60</span>, TimeUnit.SECONDS)) ;</span><br><span class="line">      searchRequest.source(searchSourceBuilder);</span><br><span class="line">      SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(JSON.toJSONString(searchResponse.getHits()));</span><br><span class="line">      System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">         System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h3 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h3><blockquote>
<p>数据问题</p>
</blockquote>
<p>爬取数据：（获取请求返回的页面信息，筛选出我们想要的数据就可以了）</p>
<p>jsoup！</p>
<p>导入依赖</p>
<h3 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h3><h3 id="搜索高亮"><a href="#搜索高亮" class="headerlink" title="搜索高亮"></a>搜索高亮</h3><blockquote>
<p>备注</p>
</blockquote>
<p>npm命令解释</p>
<ul>
<li><p><code>npm install moduleName</code>: 安装模块到项目目录下</p>
</li>
<li><p><code>npm install -g moduleName</code>: -g的意思是将模块安装到全局，具体安装到磁盘哪个位置，要看npm config prefix的位置</p>
</li>
<li><p><code>npm install -save moduleName</code>: -save的意思是将模块安装到项目目录下，并在package文件的dependencies节点写入依赖，-S为该命令的缩写。</p>
</li>
<li><p>``npm install -save-dev moduleName`:  -save-dev的意思是将模块安装到项目目录下，并在package文件的devDependencies节点写入依赖，-D为该命令的缩写。</p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/21/docker/" rel="prev" title="">
      <i class="fa fa-chevron-left"></i> 
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/21/RabbitMQ/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8B%82%E7%A5%9E%E8%81%8AElasticSearch"><span class="nav-number">1.</span> <span class="nav-text">狂神聊ElasticSearch</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ElasticSearch%E6%A6%82%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">ElasticSearch概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ElasticSearch%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">ElasticSearch安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ES%E6%A0%B8%E5%BF%83"><span class="nav-number">4.</span> <span class="nav-text">ES核心</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="nav-number">5.</span> <span class="nav-text">IK分词器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Rest%E9%A3%8E%E6%A0%BC%E8%AF%B4%E6%98%8E"><span class="nav-number">6.</span> <span class="nav-text">Rest风格说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">7.</span> <span class="nav-text">关于索引的基本操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">8.</span> <span class="nav-text">关于文档的基本操作</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E6%88%90SpringBoot"><span class="nav-number">9.</span> <span class="nav-text">集成SpringBoot</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E6%88%98"><span class="nav-number">10.</span> <span class="nav-text">实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E8%99%AB"><span class="nav-number">10.0.1.</span> <span class="nav-text">爬虫</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="nav-number">10.0.2.</span> <span class="nav-text">前后端分离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E9%AB%98%E4%BA%AE"><span class="nav-number">10.0.3.</span> <span class="nav-text">搜索高亮</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
